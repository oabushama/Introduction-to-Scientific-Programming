% -*- latex -*-
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%
%%%% This TeX file is part of the course
%%%% Introduction to Scientific Programming in C++/Fortran2003
%%%% copyright 2017/8 Victor Eijkhout eijkhout@tacc.utexas.edu
%%%%
%%%% macros for verbatisnippets
%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{verbatim}

\def\verbatimsnippet#1{\verbatiminput{#1}}
\def\codesnippet#1{\verbatiminput{snippets.code/#1}}

\makeatletter
% code location wrt book
\def\codedir{../code}
\newcommand{\answerwithoutput}[3]{
  % go into vertical mode
  \par
  % make nice two-column layout
  \iffalse
  \vbox{
    \begin{multicols}{2}
      \def\verbatim@startline{\verbatim@line{\leavevmode\relax}}
      \footnotesize\textbf{Code:}
      \codesnippet{#1}
      \par\hbox{}\vfill\columnbreak
      { \raggedright
        \textbf{Output [#2] #3:}
      }
      \hbox{}
      \immediate\write18{ cd \codedir /#2 && make #3 && make run_#3 > #3.out }
      \verbatiminput{\codedir /#2/#3.out}
      \par\hbox{}\vfill\hbox{}
    \end{multicols}
  }
  \fi
  \hbox{%
    \begin{minipage}[t]{.6\hsize}
      \def\verbatim@startline{\verbatim@line{\leavevmode\relax}}
      \footnotesize\textbf{Code:}
      \codesnippet{#1}
    \end{minipage}
    \begin{minipage}[t]{.3\hsize}
      { \footnotesize \raggedright \textbf{Output\\\relax [#2] #3:}\par
      }
      \immediate\write18{ cd \codedir /#2 && make #3 && make run_#3 > #3.out }
      \footnotesize
      \verbatiminput{\codedir /#2/#3.out}
    \end{minipage}
  }
  %\hbox{}\kern-20pt\hbox{} % 1.5\baselineskip
}

\newcommand\snippetwithoutput[3]{
  \answerwithoutput{#1}{#2}{#3}
  % record this file as bracketed name
  \ifInBook \addchaptersource{{#2/#3}} \fi
}


\newcommand{\answerwitherror}[3]{
  % go into vertical mode
  \par
  % make nice two-column layout
  \vbox{
  \begin{multicols}{2}
    \def\verbatim@startline{\verbatim@line{\leavevmode\relax}}
    \footnotesize\textbf{Code:}
    \codesnippet{#1}
    \par\hbox{}\vfill\columnbreak
        \textbf{Output [#2] #3:}
    \hbox{}
    \immediate\write18{ cd \codedir /#2 && make error_#3.o > #3.out 2>&1 }
    \verbatiminput{\codedir /#2/#3.out}
    \par\hbox{}\vfill\hbox{}
  \end{multicols}
  }
}

\newcommand\snippetwitherror[3]{
  \answerwitherror{#1}{#2}{#3}
  % record this file as bracketed name
  \ifInBook \addchaptersource{{#2/#3}} \fi
}

\newcommand{\snippetwithcomment}[2]{
  % go into vertical mode
  \par
  % make nice two-column layout
  \vbox{
  \begin{multicols}{2}
    \def\verbatim@startline{\verbatim@line{\leavevmode\relax}}
    \footnotesize\textbf{Code:}
    \codesnippet{#1}
    \par\hbox{}\vfill\columnbreak
    { \raggedright\small #2 \par }
    \par\hbox{}\vfill\hbox{}
  \end{multicols}
  }
}

\let\answerwithcomment\snippetwithcomment

\makeatother
