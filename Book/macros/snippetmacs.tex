% -*- latex -*-
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%
%%%% This TeX file is part of the course
%%%% Introduction to Scientific Programming in C++/Fortran2003
%%%% copyright 2017/8 Victor Eijkhout eijkhout@tacc.utexas.edu
%%%%
%%%% macros for verbatisnippets
%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{verbatim}

\def\verbatimsnippet#1{\verbatiminput{#1}}
\def\codesnippet#1{\verbatiminput{snippets.code/#1}}

\makeatletter
% code location wrt book
\def\codedir{../code}
\newcommand{\answerwithoutput}[3]{
  % go into vertical mode
  \par
  % make nice two-column layout
  \vbox{
    \begin{multicols}{2}
      \def\verbatim@startline{\verbatim@line{\leavevmode\relax}}
      \footnotesize\textbf{Code:}
      \codesnippet{#1}
      \par\hbox{}\vfill\columnbreak
      { \raggedright
        \textbf{Output from running #3 in code directory #2:}
      }
      \hbox{}
      \immediate\write18{ cd \codedir /#2 && make #3 && make run_#3 > #3.out }
      \verbatiminput{\codedir /#2/#3.out}
      \par\hbox{}\vfill\hbox{}
    \end{multicols}
  }
}
\newcommand\snippetwithoutput[3]{
  \answerwithoutput{#1}{#2}{#3}
  % record this file as bracketed name
  \ifInBook \addchaptersource{{#2/#3}} \fi
}
\newcommand{\snippetwitherror}[3]{
  % go into vertical mode
  \par
  % record this file as bracketed name
  \ifInBook \addchaptersource{{#2/#3}} \fi
  % make nice two-column layout
  \vbox{
  \begin{multicols}{2}
    \def\verbatim@startline{\verbatim@line{\leavevmode\relax}}
    \footnotesize\textbf{Code:}
    \codesnippet{#1}
    \par\hbox{}\vfill\columnbreak
    \textbf{Output from running #3 in code directory #2:}
    \hbox{}
    \immediate\write18{ cd \codedir /#2 && make error_#3.o > #3.out 2>&1 }
    \verbatiminput{\codedir /#2/#3.out}
    \par\hbox{}\vfill\hbox{}
  \end{multicols}
  }
}
\newcommand{\snippetwithcomment}[2]{
  % go into vertical mode
  \par
  % make nice two-column layout
  \vbox{
  \begin{multicols}{2}
    \def\verbatim@startline{\verbatim@line{\leavevmode\relax}}
    \footnotesize\textbf{Code:}
    \codesnippet{#1}
    \par\hbox{}\vfill\columnbreak
    { \raggedright\small #2 \par }
    \par\hbox{}\vfill\hbox{}
  \end{multicols}
  }
}
\let\answerwithcomment\snippetwithcomment

\makeatother
