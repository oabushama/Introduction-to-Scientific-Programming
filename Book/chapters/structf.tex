% -*- latex -*-
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%
%%%% This TeX file is part of the course
%%%% Introduction to Scientific Programming in C++/Fortran2003
%%%% copyright 2017-9 Victor Eijkhout eijkhout@tacc.utexas.edu
%%%%
%%%% structf.tex : types Fortran
%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Fortran's way of bundling up data, and naming that bundle, is a
\indextermfort{type}.

\begin{slide}{Structures: \noexpand\texttt{type}}
  \label{sl:ftype}
  The Fortran name for structures is \indextermtt{type} or
  \indextermsub{derived}{type}.
\end{slide}

Now you need to
\begin{itemize}
\item Define the type to describe what's in it;
\item Declare variables of that type; and
\item use those variables, but setting the type members or using their
  values.
\end{itemize}

\begin{block}{Type definition}
  \label{sl:ftype-def}
  \n{Type name} / \n{End Type} block.\\
  Variable declarations inside the block
\begin{lstlisting}
type mytype
  integer :: number
  character :: name
  real(4) :: value
end type mytype
\end{lstlisting}
\end{block}

\begin{block}{Creating a type structure}
  \label{sl:ftype-set}
  Declare a type object in the main program:
\begin{lstlisting}
Type(mytype) :: object1,object2
\end{lstlisting}
 Initialize with type name:
\begin{lstlisting}
object1 = mytype( 1, 'my_name', 3.7 )
\end{lstlisting}
Copying:
\begin{lstlisting}
object2 = object1
\end{lstlisting}

\end{block}

\begin{block}{Member access}
  \label{sl:ftype-access}
  Access structure members with \verb+%+
\begin{lstlisting}
Type(mytype) :: typed_object
type_object%member = ....  
\end{lstlisting}
\end{block}

\begin{block}{Example}
  \label{sl:ftype-ex}
  \begin{multicols}{2}
    \verbatimsnippet{ftypedef}
    \columnbreak
    \verbatimsnippet{ftypeuse}
  \end{multicols}
  Type definitions can go in the main program
\end{block}

You can have arrays of types:
\begin{lstlisting}
type(my_struct) :: data
type(my_struct),dimension(1) :: data_array
\end{lstlisting}

\begin{block}{Types as subprogram argument}
  \label{sl:ftype-pass}
  \begin{multicols}{2}
    \verbatimsnippet{ftypepass}
    \columnbreak
    \verbatimsnippet{ftypecall}
  \end{multicols}

\end{block}

\begin{exercise}
  \label{ex:ftype-rect}
  Define a type \n{Point} that contains real numbers~\n{x,y}.\\
  Define a type \n{Rectangle} that contains two \n{Point}s.\\
  Write a function \n{area} that has one argument, a \n{Rectangle}.
\end{exercise}
